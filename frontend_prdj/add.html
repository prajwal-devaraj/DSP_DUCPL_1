<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SecHealthDB · Add Record</title>
  <link rel="icon" href="assets/img/favicon.svg" />
  <link rel="stylesheet" href="assets/css/style.css"/>
</head>
<body class="bg-dots">
  <header class="topbar">
    <div class="brand">
      <img src="assets/img/logo.svg" alt="SecHealthDB" class="logo"/>
      <span>SecHealthDB</span>
    </div>
    <nav class="nav">
      <a href="dashboard.html">Dashboard</a>
      <a href="query.html">Query</a>
      <a class="active" href="add.html">Add Record</a>
      <button id="btnLogout" class="btn btn-ghost small">Log out</button>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <h2>New Healthcare Record</h2>
      <form id="addForm" class="form grid-3 gap">
        <div class="field">
          <label for="first_name">First name</label>
          <input id="first_name" name="first_name" required/>
        </div>
        <div class="field">
          <label for="last_name">Last name</label>
          <input id="last_name" name="last_name" required/>
        </div>
        <div class="field">
          <label for="gender">Gender</label>
          <select id="gender" name="gender" required>
            <option value="0">Female</option>
            <option value="1">Male</option>
          </select>
        </div>
        <div class="field">
          <label for="age">Age</label>
          <input id="age" name="age" type="number" min="0" required/>
        </div>
        <div class="field">
          <label for="weight">Weight (kg)</label>
          <input id="weight" name="weight" type="number" step="0.01" required/>
        </div>
        <div class="field">
          <label for="height">Height (cm)</label>
          <input id="height" name="height" type="number" step="0.01" required/>
        </div>
        <div class="field full">
          <label for="history">Health history</label>
          <textarea id="history" name="history" rows="4" required></textarea>
        </div>
        <div class="row-wrap full">
          <button class="btn btn-primary">Submit</button>
          <a class="btn btn-ghost" href="dashboard.html">Cancel</a>
        </div>
      </form>
      <div id="toast" class="toast"></div>
    </section>
  </main>

  <footer class="footer">
    <p>© 2025 SecHealthDB</p>
  </footer>

  <script src="assets/js/api.js"></script>
  <script src="assets/js/ui.js"></script>
  <script>
    enforceAuth('H'); // require Group H
    document.getElementById('btnLogout').onclick = logout;

    document.getElementById('addForm').onsubmit = async (e) => {
      e.preventDefault();
      const payload = Object.fromEntries(new FormData(e.target).entries());
      const ok = await addRecord(payload);
      toast(ok ? 'Record submitted.' : 'Failed to submit record.');
      if (ok) setTimeout(() => location.href='dashboard.html', 800);
    };
  </script>
</body>
</html>
